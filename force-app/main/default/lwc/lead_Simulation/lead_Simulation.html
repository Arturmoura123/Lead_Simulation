<template>
    <!-- Screen 1: License Plate Input with Context -->
    <div if:true={showLicensePlateScreen} class="card-section animated-card">
        <div class="card-title">Do Your Simulation</div>
        <div class="card-subtitle">Please enter your license plate to get started. Your vehicle details will be pre-filled.</div>
        <lightning-input label="License Plate" data-id="licensePlate" value={licensePlate} onchange={handleInputChange}></lightning-input>
        <div class="button-container">
            <lightning-button class="quote-button" label="Check Price" onclick={checkPrice}></lightning-button>
        </div>
    </div>

    <!-- Screen 2: Initial Price Estimate -->
    <div if:true={showPriceScreen} class="card-section animated-card">
        <div class="icon-text-container">
            <lightning-icon icon-name="utility:info" size="large" alternative-text="Info" class="icon-styled-info"></lightning-icon>
            <div class="card-info-text">
                You can get an insurance product with us starting from {randomPrice}€.
            </div>
        </div>
        <div class="button-container">
            <lightning-button label="Next" onclick={nextToNameNIF}></lightning-button>
        </div>
    </div>

    <!-- Screen 3a: Name and NIF Input -->
    <div if:true={showNameNIFScreen} class="card-section animated-card">
        <div class="icon-text-container">
            <lightning-icon icon-name="utility:people" size="small" alternative-text="People" class="icon-styled"></lightning-icon>
            <h2 class="header-text">Personal Information</h2>
        </div>
        <lightning-input label="Full Name" data-id="name" value={name} onchange={handleInputChange}></lightning-input>
        <lightning-combobox label="Sex" data-id="gender" options={genderOptions} value={gender} onchange={handleInputChange}></lightning-combobox>
        <lightning-input label="NIF" data-id="nif" value={nif} onchange={handleInputChange}></lightning-input>
        <div class="button-container">
            <lightning-button label="Back" onclick={backToPriceScreen}></lightning-button>
            <lightning-button label="Next" onclick={nextToDetails}></lightning-button>
        </div>
    </div>

    <!-- Screen 3b: Additional Details Form -->
    <div if:true={showDetailsForm} class="card-section animated-card">
        <div class="icon-text-container">
            <lightning-icon icon-name="utility:settings" size="small" alternative-text="Settings" class="icon-styled"></lightning-icon>
            <h2 class="header-text">Additional Details</h2>
        </div>
        <lightning-input label="Age" data-id="age" value={age} onchange={handleInputChange}></lightning-input>
        <lightning-input label="Car Value" data-id="carValue" value={carValue} onchange={handleInputChange}></lightning-input>
        <div class="button-container">
            <lightning-button label="Back" onclick={backToNameNIF}></lightning-button>
            <lightning-button label="See Prices" onclick={seePrices}></lightning-button>
        </div>
    </div>

    <!-- Flow Component to Calculate Premium -->
    <div if:true={renderFlow} class="flow-container animated-card">
        <lightning-flow flow-api-name={flowApiName} flow-input-variables={getFlowInputVariables} onstatuschange={handleFlowStatusChange}></lightning-flow>
    </div>

    <!-- Display Price Options -->
    <div if:true={showPriceDisplay} class="product-display-container">
        <h2 class="header-text">Choose Your Payment Option</h2>
        <div class="product-grid">
            <template for:each={priceResults} for:item="price" for:index="index">
                <div key={price.ProductId} class="product-card">
                    <h3 class="product-name">{price.productName}</h3>
                    <p class="product-description">{price.productDescription}</p>
                    <div class="price-options">
                        <div class="price-option" onclick={handleSelectMonthly} data-index={index}>
                            <p class="price-label">Monthly Payment</p>
                            <p class="price-value">{price.monthlyPremium} €</p>
                        </div>
                        <div class="price-option" onclick={handleSelectBiannual} data-index={index}>
                            <p class="price-label">Biannual Payment</p>
                            <p class="price-value">{price.semiAnnualTotalAmount} €</p>
                            <p class="price-saving">({price.semiAnnualPremium} €/month)</p>
                        </div>
                        <div class="price-option" onclick={handleSelectAnnual} data-index={index}>
                            <p class="price-label">Annual Payment</p>
                            <p class="price-value">{price.annualTotalAmount} €</p>
                            <p class="price-saving">({price.annualPremium} €/month)</p>
                        </div>
                    </div>
                    <div class="product-characteristics">
                        <ul class="custom-bullet-list">
                            <template for:each={price.productCharacteristics} for:item="characteristic">
                                <li key={characteristic}><span>{characteristic}</span></li>
                            </template>
                        </ul>
                    </div>                    
                </div>
            </template>
        </div>
        <div class="button-container-final">
            <lightning-button class="leave-button" label="Leave" onclick={leaveSimulation}></lightning-button>
        </div>
    </div>
</template>
